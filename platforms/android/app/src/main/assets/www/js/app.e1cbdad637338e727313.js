webpackJsonp([1],{0:function(e,t){},1:function(e,t){},2:function(e,t){},3:function(e,t){},4:function(e,t){},5:function(e,t){},D1aF:function(e,t){},NHnr:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=n("7+uW"),r={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("router-view")],1)},staticRenderFns:[]};var o=n("VU/8")({name:"App"},r,!1,function(e){n("VX8I")},null,null).exports,s=n("/ocq"),i=n("Dd8w"),c=n.n(i),u=n("Gu7T"),l=n.n(u),f=n("//Fk"),d=n.n(f),p=n("mtWM"),h=n.n(p);h.a.defaults.baseURL="http://202.115.47.141/",h.a.defaults.timeout=1e9,h.a.defaults.headers.post["Content-Type"]="application/x-www-form-urlencoded";var m=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new d.a(function(n,a){h.a.get(e,t).then(function(e){n(e)}).catch(function(e){a(e)})})},v=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return new d.a(function(n,a){h.a.post(e,t).then(function(e){n(e)}).catch(function(e){a(e)})})};var g=n("yCyq"),_=n("NYxO"),w=n("7t+N"),y=n.n(w),b={name:"home",data:function(){return{username:"",password:"",captcha:"",pic:"",mutex:!1,sqlData:[],dialogVisible:!1,username_choice:"",delAll:!1}},methods:c()({},Object(_.b)(["setUsername"]),{gotoHome:function(e){var t=this;this.$notify.success({message:"登录成功"}),y.a.each(y.a.parseHTML(e),function(e,n){if("navbar"===n.id){var a=y()(y.a.parseHTML(y()(n).find(".user-info:first").html())[2]).text().trim();t.setUsername(a),t.$router.push("/home")}})},_Login:function(){var e,t,n,a,r=this,o=this.$loading({fullscreen:!0,text:"正在登录..."});(e=this.username,t=this.password,n=this.captcha,a=function(e){var t="";for(var n in e)t=t+n+"="+e[n]+"&";return t.substring(0,t.length-1)}({j_username:e,j_password:t,j_captcha:n}),v("/j_spring_security_check",a)).then(function(e){r._addUser(r.username,r.password),o.close(),r.gotoHome(e.data)}).catch(function(e){var t=e.response.request.responseURL;t.endsWith("badCaptcha")&&r.$notify.error({message:"验证码错误"}),t.endsWith("badCredentials")&&r.$notify.error({message:"账号或密码错误"}),o.close(),r._getCaptcha()})},_getCaptcha:function(){var e=this;m("/img/captcha.jpg",{responseType:"arraybuffer"}).then(function(t){e.pic="data:image/png;base64,"+btoa(new Uint8Array(t.data).reduce(function(e,t){return e+String.fromCharCode(t)},""))})},_addUser:function(e,t){var n=this;!function(e,t,n){a.default.prototype.GLOBAL.DB().transaction(function(a){a.executeSql("insert into user (username,password) values (?,?);",[e,t],function(e,t){n()},function(a,r){6===r.code&&a.executeSql("update user set password=? where username=?",[t,e],function(e,t){n()},function(e,t){console.log(t)})})})}(e,t,function(){n.flashUser()})},_delUser:function(e){var t=this;!function(e,t){a.default.prototype.GLOBAL.DB().transaction(function(n){n.executeSql("delete from user where username=?;",[e],function(e,n){t()})})}(e,function(){t.flashUser()}),this.dialogVisible=!1},imRead:function(e){var t;t=document.getElementById(e);var n=null,a=null;(n=document.createElement("canvas")).width=180,n.height=60,(a=n.getContext("2d")).drawImage(t,0,0,180,60);var r=a.getImageData(0,0,n.width,n.height),o=function e(t){for(var n=arguments.length,a=Array(n>1?n-1:0),r=1;r<n;r++)a[r-1]=arguments[r];if(0===a.length)return t;for(var o=new Array(a[0]),s=a.slice(1),i=0;i<a[0];i++)o[i]=e.apply(void 0,[t].concat(l()(s)));return o}(null,1,60,180,3);return o[0].forEach(function(e,t,n){n[t].forEach(function(e,n,a){a[n].forEach(function(e,a,o){o[a]=r.data[4*(180*t+n)+a]/255})})}),o},getYZM:function(){var e=this;this.mutex||null!=this.GLOBAL.MODEL()&&(this.mutex=!0,this.captcha=g.c(function(){var t=g.b(e.imRead("captcha"));return e.GLOBAL.MODEL().predict(t).reduce(function(t,n){return t+e.GLOBAL.characters[n.as1D().argMax().arraySync()]},"")}),this.mutex=!1)},querySearch:function(e,t){var n=this.sqlData;t(e?this.sqlData.filter(function(t){return 0===t.username.toLowerCase().indexOf(e.toLowerCase())}):n)},handleSelect:function(e){this.username=e.username,this.password=e.password},flashUser:function(){var e,t,n=this;e=function(e){n.sqlData=e},t=[],a.default.prototype.GLOBAL.DB().transaction(function(n){n.executeSql("select * from user;",[],function(n,a){for(var r=0;r<a.rows.length;r++)t.push(a.rows.item(r));e(t)},function(e,t){})})}}),mounted:function(){var e=this,t=this.$loading({fullscreen:!0,text:"缓存登录中..."}),n=!1;m("/index.jsp").then(function(t){t.request.responseURL.endsWith("index.jsp")&&(n=!0,e.gotoHome(t.data))}).finally(function(){if(t.close(),!n){var a=e.$loading({fullscreen:!0,text:"模型加载中..."}),r=0,o=setInterval(function(){r++>100&&(clearInterval(o),a.close(),e.$notify.error({message:"模型加载失败"})),null!=e.GLOBAL.MODEL()&&(clearInterval(o),a.close(),e.$notify.success({message:"模型加载成功"}),document.getElementById("captcha").onload=function(){e.getYZM()},e._getCaptcha())},100);e.flashUser()}})}},x={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticStyle:{height:"100%"}},[n("el-row",{staticClass:"content",staticStyle:{margin:"15px"}},[n("el-col",{attrs:{span:24}},[n("el-autocomplete",{staticStyle:{width:"100%"},attrs:{"fetch-suggestions":e.querySearch,placeholder:"学号","popper-class":"usernameClass"},on:{select:e.handleSelect},scopedSlots:e._u([{key:"default",fn:function(t){var a=t.item;return n("div",{staticStyle:{margin:"10px"}},[n("span",[e._v(e._s(a.username))]),e._v(" "),n("i",{staticClass:"el-icon-delete el-input__icon",on:{click:function(){e.dialogVisible=!0,e.username_choice=a.username,e.delAll=!1}}})])}}]),model:{value:e.username,callback:function(t){e.username=t},expression:"username"}})],1),e._v(" "),n("el-col",{attrs:{span:24}},[n("el-input",{attrs:{type:"password",placeholder:"密码"},model:{value:e.password,callback:function(t){e.password=t},expression:"password"}})],1),e._v(" "),n("el-col",{attrs:{span:14}},[n("el-input",{attrs:{type:"text",placeholder:"验证码"},model:{value:e.captcha,callback:function(t){e.captcha=t},expression:"captcha"}})],1),e._v(" "),n("el-col",{attrs:{span:10}},[n("img",{staticStyle:{height:"40px"},attrs:{id:"captcha",src:e.pic},on:{click:e._getCaptcha}})]),e._v(" "),n("el-col",{attrs:{span:24}},[n("el-button",{staticStyle:{width:"100%"},attrs:{type:"primary"},on:{click:e._Login}},[e._v("登录")])],1)],1),e._v(" "),n("el-dialog",{attrs:{title:"提示",visible:e.dialogVisible,width:"80%"},on:{"update:visible":function(t){e.dialogVisible=t}}},[n("span",[e._v("您确定要删除账号:"+e._s(e.username_choice))]),e._v(" "),n("div",[e._v("同时删除该账号数据\n      "),n("el-switch",{attrs:{"active-color":"#13ce66"},model:{value:e.delAll,callback:function(t){e.delAll=t},expression:"delAll"}})],1),e._v(" "),n("span",{attrs:{slot:"footer"},slot:"footer"},[n("el-button",{on:{click:function(t){e.dialogVisible=!1}}},[e._v("取 消")]),e._v(" "),n("el-button",{attrs:{type:"danger"},on:{click:function(t){return e._delUser(e.username_choice)}}},[e._v("删 除")])],1)])],1)},staticRenderFns:[]};var L=n("VU/8")(b,x,!1,function(e){n("WER1")},"data-v-22519b02",null).exports,S={name:"home",computed:c()({},Object(_.c)(["username"])),methods:{_logOut:function(){var e=this;m("/logout").then(function(t){e.$router.push("/")})}}},A={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",[this._v("\n  这是home页面,welcome "+this._s(this.username)+"\n  "),t("el-button",{staticStyle:{width:"100%"},attrs:{type:"danger"},on:{click:this._logOut}},[this._v(" 注销")])],1)},staticRenderFns:[]};var O=n("VU/8")(S,A,!1,function(e){n("D1aF")},"data-v-5e8e62a6",null).exports;a.default.use(s.a);var U=new s.a({routes:[{path:"/login",name:"Login",component:L},{path:"/",redirect:"/login"},{path:"/home",name:"home",component:O}]});a.default.use(_.a);var k,q=new _.a.Store({state:{username:""},mutations:{setUsername:function(e,t){e.username=t}}}),D=n("zL8q"),E=n.n(D),C=(n("tvR6"),n("Xxa5")),B=n.n(C),$=n("exGp"),j=(k=n.n($)()(B.a.mark(function e(){return B.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,g.a("https://github.com/wuuuudle/SCUExtension/raw/master/model/model.json");case 2:return M=e.sent,e.abrupt("return",M);case 4:case"end":return e.stop()}},e,this)})),function(){return k.apply(this,arguments)}),R=null,M=null;document.addEventListener("deviceready",function(){(R=window.sqlitePlugin.openDatabase({name:"my.db",location:"default"})).transaction(function(e){e.executeSql("create table if not exists user (username varchar(20) primary key, password varchar(50))")},function(e){console.log("error:"+e.message)},function(){console.log("OK")});var e=0;document.addEventListener("backbutton",function(){console.log(G.$route.path),0===e?(e++,window.plugins.toast.showShortBottom("再点一次退出!"),setTimeout(function(){e=0},2e3)):1===e&&navigator.app.exitApp()})}),j().then();var V={DB:function(){return R},MODEL:function(){return M},characters:"0123456789abcdefghijklmnopqrstuvwxyz"};n.d(t,"vue",function(){return G}),a.default.config.productionTip=!1,a.default.use(E.a),a.default.prototype.GLOBAL=V;var G=new a.default({el:"#app",router:U,store:q,components:{App:o},template:"<App/>"})},VX8I:function(e,t){},WER1:function(e,t){},tvR6:function(e,t){}},["NHnr"]);